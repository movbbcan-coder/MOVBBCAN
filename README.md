# MOVBBCAN
TELEGRAM GRID BOT
PROJECT NAME: MOVBBCAN   


Задача: Преобразовать полнофункциональный торговый бот для Bybit (изначально спроектированный как веб-сайт) в автономного Telegram-бота. Бот должен сохранить всю исходную логику работы с сетками (лонг/шорт, до 200 ордеров, индивидуальный TP, мартингейл, частичная выставка), но перенести весь интерфейс управления и уведомления в Telegram, добавив новые, обсужденные варианты работы: автоторговля по RSI и непрерывный цикл сеток.

Архитектура (Упрощенная и оптимизированная для Telegram):

· Backend: Node.js (Express.js/NestJS). Python (aiogram + ccxt/pybit) также является отличным вариантом для данной задачи.
· База данных: SQLite (для 2 пользователей достаточно) или PostgreSQL. Схема данных (User, Bot, BotOrder, TradeHistory) остается без изменений.
· Интеграции:
  · Bybit API: Для всех торговых операций и получения данных о цене для расчета RSI.
  · Telegram Bot API: Для всего взаимодействия с пользователем.
  · TradingView Webhook: (ОПЦИОНАЛЬНО) Если пользователь выберет этот метод.
· Ключевое отличие: Отсутствие фронтенда (React). Весь UI — это кнопки, команды и сообщения в Telegram.

Стратегия работы (Signal Source): Пользователь должен выбирать один из трех режимов при создании бота:

1. TradingView Alert: Классический режим из ТЗ. Бот ждет вебхук от TradingView для активации сетки.
2. RSI Auto-Trading: Бот самостоятельно рассчитывает RSI на основе цен с Bybit и открывает сетки при достижении заданных уровней (например, RSI < 30 для лонга, RSI > 70 для шорта). Реализовать функцию расчета RSI внутри бота.
3. Continuous Grid Mode (Непрерывный цикл): После закрытия сетки по TP бот автоматически сразу выставляет две новые сетки (лонг и шорт). Режим не требует анализа рынка. Обязательно добавить глобальный стоп-лосс на депозит для этого режима.

Основные команды и UX-поток в Telegram:

```
/user start -> Приветственное сообщение с инструкцией.
/user connect_bybit -> Инструкция по вводу API-ключей (сообщение удаляется после ввода).
/user new_bot -> Интерактивный диалог создания бота через кнопки и запросы:
    • Выбор торговой пары (список из Bybit).
    • Выбор направления (Лонг/Шорт) или "Both" для Continuous Mode.
    • Выбор источника сигнала: TradingView / RSI / Continuous.
    • Если выбран RSI: запрос параметров (период, уровни перекупленности/перепроданности).
    • Настройка параметров сетки 

Процент перекрытия: 1–100% (с точным вводом числа).

Мартингейл: 0.5–100%.

Кол-во ордеров:  1–200.

Частичная выставка:  1–10 (одновременных ордеров).

//Финансовые параметры

Баланс пользователя (только просмотр).

Депозит (ввод вручную).

Плечо (dropdown: 1×–50×).

Тип маржи: фиксированный (перекрёстная).

• Настройка TP (общий и/или индивидуальный).
// Параметры профита  

Вариант1-Профит переменны:  0.1–100%. (для каждой сетки индивидуальный вставка профитоф)
Вариянт2-Профит общий: 0.1-100%

Индивидуальный профит по каждой сетке: таблица с вводом значений или автонастройка.т.д.) через инлайн-клаввиатуру с ползунками или ввод чисел.
    • Расчет и отображение рисков (маржа, цена ликвидации).
    • Кнопка "Запустить" "Остановить" "Редактировать"
/user my_bots -> Список активных ботов с краткими статусами (Пара, Режим, PnL). Кнопка управления для каждого.
/user bot_<ID> -> Детальная панель управления конкретным ботом:
    • Текстовый вывод текущего состояния (статус, кол-во открытых ордеров, текущий PnL).
    
    • Кнопки быстрого управления: [Обновления] [Пауза], [Закрыть все], [Изменить TP], [Стоп].
/user stats -> Отправляет файл `CSV` с историей сделок и график общего PnL (сгенерированный изображением).
```

Логика уведомлений: Бот присылает сообщения о:исполнении ордеров, закрытии сетки, ошибках, достижении стоп-лосса в Continuous-режиме.

Модернизированная схема данных (Добавляем новые поля): В таблицеBot добавить поля:

· signal_source ENUM('tradingview', 'rsi', 'continuous')
· rsi_period INTEGER
· rsi_overbought INTEGER (e.g., 70)
· rsi_oversold INTEGER (e.g., 30)
· global_stop_loss DECIMAL (для continuous mode)

Контракты API (Упрощаются, т.к. все инициируется через Telegram):

· Большинство POST /api/... эндпоинтов становятся внутренними методами, которые вызываются обработчиками команд бота.
· Эндпоинт для вебхука TradingView (POST /webhook/tradingview/:botId) остается.
· Добавляется внутренний метод calculateAndCheckRSI(symbol, period), который вызывается по расписанию (например, раз в минуту) для ботов в режиме RSI.

Безопасность:

· API-ключи шифруются перед сохранением в БД.
· Все операции требуют привязки к user_id и chat_id Telegram.

Что реализовать в первую очередь:

1. Каркас бота на выбранном фреймворке (Node.js + node-telegram-bot-api или Python + aiogram).
2. Систему команд (/start, /connect, /new_bot).
3. Меню создания бота с выбором режима работы (TradingView, RSI, Continuous).
4. Ядро торговой логики (расчет сетки, размещение ордеров на Bybit, мониторинг позиций) – оно остается практически неизменным с веб-версии.
5. Логику для каждого из режимов:
   · Для TradingView: ожидание вебхука.
   · Для RSI: периодический опрос цены и расчет индикатора.
   · Для Continuous: автоматический перезапуск после закрытия по TP.
6. Систему уведомлений.

Критерии успеха: Пользователь может через чат с ботом:

1. Безопасно подключить аккаунт Bybit.
2. Создать и запустить бота в одном из трех режимов.
3. Получать своевременные уведомления о событиях.
4. Управлять ботом (пауза, остановка) и просматривать базовую статистику.
5. Для режима RSI и Continuous стратегия работает автономно без внешних сигналов.
